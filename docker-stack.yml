version: "3.1"
services:
  web:
    image: dockercouchdb_web
    ports:
      - "3000:3000"
    networks:
      - backend
    volumes:
      - node_modules:/app/node_modules:ro
      - .:/app
    depends_on:
      - database
    environment:
      PORT: 2305
      HOST: 0.0.0.0
      WEBPACK_PORT: 3000
      DATABASE_PORT: 5984
      COUCHDB_USER: admin
      COUCHDB_PASSWORD: /run/secrets/db_admin_password
    secrets:
      - db_admin_password

  database:
    image: couchdb:2.1.1
    networks:
      - backend
    volumes:
      - database:/app/data
    environment:
      COUCHDB_USER: admin
      COUCHDB_PASSWORD: /run/secrets/db_admin_password
    secrets:
      - db_admin_password

networks:
  backend:

volumes:
  database:
  node_modules:

secrets:
  db_admin_password:
    file: .secrets/db-admin-password.txt
